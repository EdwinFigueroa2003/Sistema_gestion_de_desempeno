{% extends "layout.html" %}

{% block title %}
Resultado de Análisis Organizacional
{% endblock %}

{% block content %}

<h1>Gestión del Desempeño</h1>
<hr>

<body>
    <reporte>Reporte de Análisis Organizacional</reporte>

    {% if reporte %}
    <div class="dimension-buttons">
        {% for dimension in reporte|groupby('dimension') %}
        <button onclick="filterByDimension('{{ dimension.grouper }}')">{{ dimension.grouper }}</button>
        {% endfor %}
    </div>

    <!-- Mostrar el promedio de semaforización -->
    <div id="promedio-semaforo" style="display: none; margin-bottom: 20px;">
        <descripcion>Promedio de Semaforización:</descripcion>
        <div class="semaforo">
            <div class="luz rojo" id="promedio-rojo"></div>
            <div class="luz amarillo" id="promedio-amarillo"></div>
            <div class="luz verde" id="promedio-verde"></div>
        </div>
        <descripcion>Revisa por qué</descripcion>
        <br>
        <descripcion>Valores: 1 = Verde, 2 = Amarillo, 3 = Rojo</descripcion>
    </div>

    <table>
        <thead>
            <tr>
                <th>Dimensión</th>
                <!-- <th>Pregunta</th> -->
                <th>Respuesta</th>
                <th>Semaforización</th>
            </tr>
        </thead>
        <tbody>
            {% for item in reporte %}
            <tr class="dimension-row" data-dimension="{{ item.dimension }}">
                <td>{{ item.dimension }}</td>
                <!-- <td>{{ item.pregunta }}</td> -->
                <td>{{ item.respuesta }}</td>
                <td>
                    <div class="semaforo">
                        <div class="luz rojo {% if item.semaforizacion == 3 %}encendido{% endif %}"></div>
                        <div class="luz amarillo {% if item.semaforizacion == 2 %}encendido{% endif %}"></div>
                        <div class="luz verde {% if item.semaforizacion == 1 %}encendido{% endif %}"></div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
</body>

<div class="btn">
    <a href="/reportes" class="volver1">VOLVER</a>
</div>

<img src="{{ url_for('static', filename='img/mariposa0.png')}}" class="mariposa" />
<img src="{{ url_for('static', filename='img/organizacion0.png')}}" class="usuarios" />

<style>
    .dimension-buttons button {
        margin-top: 10px;
        margin-bottom: 10px;
        z-index: 1000;
        background-color: #838383;
        border: 1px solid #838383;
        border-radius: 10px;
        color: #ffffff;
        /* width: 175px; */ /* Ancho */
        height: 50px;  /* Alto */
    }

    .dimension-buttons button:hover {
        color: #333333;
    }
 
    descripcion {
        margin-bottom: 35px;
        margin-top: 35px;
        font-size: 25px;
        color: #333333;
    }

    reporte {
        color: #333333;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        z-index: 1;
        margin-top: -50px;
        font-size: 40px;
    }

    .semaforo {
        display: flex;
    }

    .luz {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        margin: 0 5px;
        background-color: gray;
    }

    .luz.encendido {
        background-color: currentColor;
    }

    .rojo {
        color: red;
    }

    .amarillo {
        color: yellow;
    }

    .verde {
        color: green;
    }
</style>

<script>
    // Verificar si la variable 'promedios' ya ha sido declarada
    if (typeof window.promedios === 'undefined') {
        window.promedios = JSON.parse('{{ promedios|default("[]")|tojson|safe }}');
    }

    console.log(window.promedios);

    function filterByDimension(dimension) {
        const rows = document.querySelectorAll('.dimension-row');
        rows.forEach(row => {
            if (row.dataset.dimension === dimension || dimension === 'all') {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });

        // Verificar si existen promedios antes de usar
        if (window.promedios && window.promedios[dimension] !== undefined) {
            const promedio = window.promedios[dimension];
            document.getElementById('promedio-semaforo').style.display = 'block';

            // Limpiar clases primero
            document.getElementById('promedio-rojo').classList.remove('encendido');
            document.getElementById('promedio-amarillo').classList.remove('encendido');
            document.getElementById('promedio-verde').classList.remove('encendido');

            // Aplicar la clase correspondiente
            if (promedio >= 2.5) {
                document.getElementById('promedio-rojo').classList.add('encendido');
            } else if (promedio >= 1.5) {
                document.getElementById('promedio-amarillo').classList.add('encendido');
            } else {
                document.getElementById('promedio-verde').classList.add('encendido');
            }
        }
    }
</script>


{% endblock %}